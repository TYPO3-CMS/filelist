/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{html as l,nothing as g}from"lit";import{lll as i}from"@typo3/core/lit-helper.js";import{until as h}from"lit/directives/until.js";import f from"@typo3/core/event/regular-event.js";import{FileListActionEvent as v}from"@typo3/filelist/file-list-actions.js";import s from"@typo3/backend/modal.js";import p from"@typo3/core/ajax/ajax-request.js";import"@typo3/core/ajax/ajax-response.js";import u from"@typo3/backend/notification.js";import _ from"@typo3/backend/viewport.js";import{FormatUtility as y}from"@typo3/backend/utility/format-utility.js";import{ThumbnailSize as w}from"@typo3/backend/element/thumbnail-element.js";import{DateTime as k}from"luxon";class ${constructor(){new f(v.replace,e=>{const t=e.detail.resources[0],c=s.advanced({title:i("file_replace.title",t.name),type:s.types.default,size:s.sizes.small,content:l`${h(this.loadEditor(t.identifier),l`<typo3-backend-spinner></typo3-backend-spinner>`)}`,buttons:[{text:TYPO3.lang["file_replace.button.cancel"]||"Cancel",btnClass:"btn-default",name:"cancel",trigger:()=>{c.hideModal()}},{text:TYPO3.lang["file_replace.button.replace"]||"Replace",btnClass:"btn-primary",name:"rename",trigger:()=>{c.querySelector("form")?.requestSubmit()}}],callback:function(o){new f("submit",m=>{m.preventDefault();const d=new FormData(m.target);d.set("uid",t.uid.toString()),new p(TYPO3.settings.ajaxUrls.resource_replace).post(d).then(async b=>{const n=await b.resolve();n.status.length>0&&n.status.forEach(a=>{n.success?u.success(a.title,a.message):u.error(a.title,a.message)}),_.ContentContainer.refresh(),o.hideModal()})}).delegateTo(o,"form")}})}).bindTo(document)}async loadEditor(e){const t=await(await new p(TYPO3.settings.ajaxUrls.resource_gather).withQueryArguments({identifier:e}).get()).resolve();return this.composeEditForm(t)}composeEditForm(e){const r=(typeof opener?.top?.TYPO3<"u"?opener.top:top).TYPO3.settings.DateTimePicker.DateFormat,t=new URL(top.TYPO3.settings.Resource.thumbnailUrl,window.origin);return t.searchParams.set("identifier",e.uid.toString(10)),l`<div class=file-replace-dialog>${i("file_replace.intro",e.name)}<div class=file-replace-dialog-summary>${e.hasPreview?l`<div class=file-replace-dialog-summary-thumbnail><typo3-backend-thumbnail url=${t} size=${w.large} width=96 keepaspectratio></typo3-backend-thumbnail></div>`:g}<div class=file-replace-dialog-summary-info><dl><dt>${i("file_info_filename")}</dt><dd>${e.name}</dd><dt>${i("file_info_filesize")}</dt><dd>${y.fileSizeAsString(e.size)}</dd><dt>${i("file_info_creation_date")}</dt><dd>${k.fromSeconds(e.createdAt).toFormat(r[1])}</dd></dl></div></div><form><div class=form-group><label class=form-label for=file_replace>${i("file_replace.new_file.label")}</label> <input id=file_replace type=file class=form-control name=replace_1></div><div class=form-check><input type=checkbox value=1 id=keepFilename name=keepFilename class=form-check-input checked> <label class=form-check-label for=keepFilename>${i("file_replace.keepFilename.label",e.name)}</label></div></form></div>`}}var F=new $;export{F as default};
